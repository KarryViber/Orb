import{r as Y,E as p,d as W,u as j,a as O,o as q,c as P,f as a,b as m,h as n,g,P as M,T as A,w as J,m as B,n as b,j as t,i as S,t as u,F as $,l as z,y as E,_ as H}from"./index-ewiXgSs4.js";const k="sns_web_configs",Q=()=>{try{const c=localStorage.getItem(k);if(!c)return[];const e=JSON.parse(c);return console.log("[getLocalConfigs] 从本地存储获取配置:",e),e}catch(c){return console.error("获取本地配置失败:",c),[]}},X=c=>{try{console.log("[saveLocalConfigs] 保存配置到本地存储:",c),localStorage.setItem(k,JSON.stringify(c))}catch(e){console.error("保存配置到本地存储失败:",e)}},Z=async(c,e)=>{try{console.log(`[updateConfig] 正在更新配置 ${c}:`,e);const T=(await Y.put(`/api/configs/${c}`,e)).data;console.log("[updateConfig] 后端更新成功:",T);let _=Q();const h=_.findIndex(C=>C.key===c),o={key:c,value:e.value,description:e.description||null};return h>=0?_[h]=o:_.push(o),X(_),console.log("[updateConfig] 本地存储更新成功"),o}catch(I){return console.error("更新配置失败:",I),p.error("更新配置失败"),null}},ee={class:"config-view"},oe={class:"card-header"},ne={class:"form-help"},te={class:"form-help"},le={class:"cookies-example"},ae=W({__name:"ConfigView",setup(c){const{t:e}=j(),I=O(),T=O(),_=O(!1),h=O(!1),o=O({APIFY_API_TOKEN:"",INSTAGRAM_USERNAME:"",INSTAGRAM_PASSWORD:"",INSTAGRAM_COOKIES:""}),C={APIFY_API_TOKEN:[{required:!0,message:e("config.validation.apiTokenRequired"),trigger:"blur"},{min:20,message:e("config.validation.apiTokenLength"),trigger:"blur"}],INSTAGRAM_USERNAME:[{required:!0,message:e("config.validation.usernameRequired"),trigger:"blur"}],INSTAGRAM_PASSWORD:[{required:!0,message:e("config.validation.passwordRequired"),trigger:"blur"}],INSTAGRAM_COOKIES:[{validator:(l,s,r)=>{if(!s){r();return}try{JSON.parse(s),r()}catch{r(new Error(e("config.validation.invalidJson")))}},trigger:"blur"}]},G=()=>{_.value=!0;try{const l=M.getAllConfigs();o.value={APIFY_API_TOKEN:l[A.API_TOKEN]||"",INSTAGRAM_USERNAME:l[A.USERNAME]||"",INSTAGRAM_PASSWORD:l[A.PASSWORD]||"",INSTAGRAM_COOKIES:l[A.COOKIES]||""}}catch(l){console.error("[ConfigView] 加载配置失败:",l),p.error(e("config.messages.loadFailed"))}finally{_.value=!1}},K=async()=>{if(!o.value.APIFY_API_TOKEN){p.warning(e("config.messages.pleaseInputToken"));return}try{p.success(e("config.messages.tokenValid"))}catch{p.error(e("config.messages.tokenInvalid"))}},y=async()=>{if(I.value)try{await I.value.validate(),h.value=!0,M.saveConfigs({[A.API_TOKEN]:o.value.APIFY_API_TOKEN,[A.USERNAME]:o.value.INSTAGRAM_USERNAME,[A.PASSWORD]:o.value.INSTAGRAM_PASSWORD,[A.COOKIES]:o.value.INSTAGRAM_COOKIES});const l=Object.entries(o.value).map(([s,r])=>Z(s,{value:r}));await Promise.all(l),p.success(e("config.messages.saveSuccess"))}catch(l){console.error("[ConfigView] 保存配置失败:",l),p.error(e("config.messages.saveFailed"))}finally{h.value=!1}},F=()=>{const l={...o.value},s=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download="sns_web_config.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},V=()=>{var l;(l=T.value)==null||l.click()},U=l=>{var i;const s=(i=l.target.files)==null?void 0:i[0];if(!s)return;const r=new FileReader;r.onload=async w=>{var v;try{const N=(v=w.target)==null?void 0:v.result,R=JSON.parse(N);Object.keys(o.value).forEach(d=>{d in R&&(o.value[d]=R[d])}),await y(),p.success(e("config.messages.importSuccess"))}catch(N){console.error("导入配置失败:",N),p.error(e("config.messages.importFailed"))}T.value&&(T.value.value="")},r.readAsText(s)};return q(()=>{G()}),(l,s)=>{const r=g("el-text"),i=g("el-button"),w=g("el-tooltip"),v=g("el-input"),N=g("el-link"),R=g("el-popover"),d=g("el-form-item"),x=g("el-form"),D=g("el-card"),L=B("loading");return E(),P("div",ee,[a(D,{class:"config-card"},{header:n(()=>[m("div",oe,[m("h2",null,u(t(e)("config.systemConfig")),1),a(r,{type:"info"},{default:n(()=>[S(u(t(e)("config.configTip")),1)]),_:1})])]),default:n(()=>[J((E(),b(x,{ref_key:"formRef",ref:I,model:o.value,rules:C,"label-width":"140px"},{default:n(()=>[a(d,{label:t(e)("config.apiToken"),prop:"APIFY_API_TOKEN"},{default:n(()=>[a(v,{modelValue:o.value.APIFY_API_TOKEN,"onUpdate:modelValue":s[0]||(s[0]=f=>o.value.APIFY_API_TOKEN=f),placeholder:t(e)("config.apiTokenPlaceholder"),"show-password":""},{append:n(()=>[a(w,{content:t(e)("config.testTokenTip"),placement:"top"},{default:n(()=>[a(i,{onClick:K},{default:n(()=>[S(u(t(e)("config.testToken")),1)]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","placeholder"]),m("div",ne,[a(R,{placement:"right",width:300,trigger:"hover"},{reference:n(()=>[a(N,{type:"primary"},{default:n(()=>[S(u(t(e)("config.howToGetToken")),1)]),_:1})]),default:n(()=>[m("h4",null,u(t(e)("config.howToGetTokenTitle")),1),(E(!0),P($,null,z(t(e)("config.howToGetTokenSteps"),f=>(E(),b(r,{key:f,class:"help-step"},{default:n(()=>[S(u(f),1)]),_:2},1024))),128))]),_:1})])]),_:1},8,["label"]),a(d,{label:t(e)("config.instagramAccount"),prop:"INSTAGRAM_USERNAME"},{default:n(()=>[a(v,{modelValue:o.value.INSTAGRAM_USERNAME,"onUpdate:modelValue":s[1]||(s[1]=f=>o.value.INSTAGRAM_USERNAME=f),placeholder:t(e)("config.instagramUsername")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(d,{label:t(e)("config.instagramPassword"),prop:"INSTAGRAM_PASSWORD"},{default:n(()=>[a(v,{modelValue:o.value.INSTAGRAM_PASSWORD,"onUpdate:modelValue":s[2]||(s[2]=f=>o.value.INSTAGRAM_PASSWORD=f),type:"password",placeholder:t(e)("config.instagramPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(d,{label:t(e)("config.instagramCookies"),prop:"INSTAGRAM_COOKIES"},{default:n(()=>[a(v,{modelValue:o.value.INSTAGRAM_COOKIES,"onUpdate:modelValue":s[3]||(s[3]=f=>o.value.INSTAGRAM_COOKIES=f),type:"textarea",rows:6,placeholder:t(e)("config.instagramCookiesPlaceholder")},null,8,["modelValue","placeholder"]),m("div",te,[a(R,{placement:"right",width:300,trigger:"hover"},{reference:n(()=>[a(N,{type:"primary"},{default:n(()=>[S(u(t(e)("config.cookiesFormat")),1)]),_:1})]),default:n(()=>[m("h4",null,u(t(e)("config.cookiesFormatTitle")),1),m("pre",le,u(t(e)("config.cookiesFormatContent")),1)]),_:1})])]),_:1},8,["label"]),a(d,null,{default:n(()=>[a(i,{type:"primary",onClick:y,loading:h.value},{default:n(()=>[S(u(t(e)("config.saveConfig")),1)]),_:1},8,["loading"]),a(i,{onClick:F},{default:n(()=>[S(u(t(e)("config.exportConfig")),1)]),_:1}),a(i,{onClick:V},{default:n(()=>[S(u(t(e)("config.importConfig")),1)]),_:1})]),_:1})]),_:1},8,["model"])),[[L,_.value]])]),_:1}),m("input",{type:"file",ref_key:"fileInput",ref:T,style:{display:"none"},accept:".json",onChange:U},null,544)])}}}),re=H(ae,[["__scopeId","data-v-5b9bfb32"]]);export{re as default};
