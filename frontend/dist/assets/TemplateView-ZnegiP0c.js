import{a as c,E as me,d as ve,u as _e,o as fe,S as H,H as be,c as A,b as r,f as l,h as o,g as p,j as s,i as m,B as ge,t as u,w as we,m as he,n as $,e as K,F as J,l as Q,p as ye,N as ke,v as Ce,x as xe,y as g,_ as Ve}from"./index-ewiXgSs4.js";import{t as x}from"./templates-8GEpwE_4.js";import{P as L}from"./common-BXy4DxN9.js";import"./apiResponse-6A7YpRFR.js";const Te=()=>{const d=c(!1),e=c(null);return{loading:d,error:e,withLoading:async f=>{d.value=!0,e.value=null;try{return await f()}catch(V){return e.value=V,me.error("操作失败，请稍后重试"),null}finally{d.value=!1}}}},E={required:d=>({required:!0,message:d,trigger:"blur"}),length:(d,e)=>({min:d,max:e,message:`长度在 ${d} 到 ${e} 个字符`,trigger:"blur"}),number:(d,e)=>({type:"number",min:d,max:e,message:`数值范围在 ${d} 到 ${e} 之间`,trigger:"blur"}),email:()=>({type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}),url:()=>({type:"url",message:"请输入正确的URL地址",trigger:["blur","change"]}),custom:d=>({validator:d,trigger:"change"})},De={class:"template-view"},Se={class:"header"},Le={class:"header-left"},Ee={class:"template-name"},ze={class:"name-text"},Re={class:"template-content"},$e={class:"template-variables"},Ie={class:"operation-tags"},Ue={class:"pagination-container"},Be={class:"template-input-section"},Ne={class:"variables-section"},Pe={class:"variables-list"},qe={class:"preview-button"},Ae={class:"preview-content"},Me={class:"preview-title"},Fe={class:"preview-text"},Oe=ve({__name:"TemplateView",setup(d){const{t:e}=_e(),{loading:M,withLoading:f}=Te(),V=c([]),F=c(0),T=c(1),z=c(10),w=c(!1),I=c(""),U=c(),i=c({id:0,name:"",content:"",variables:[],platform:L.INSTAGRAM,is_default:!1,updated_at:new Date().toISOString()}),X={name:[E.required(e("template.nameRule")),E.length(2,50)],content:[E.required(e("template.contentRule")),E.length(1,1e3)],platform:[E.required(e("template.platformRule"))]},Y=[{label:e("template.variableLabels.username"),value:"username",description:e("template.variableDescriptions.username")},{label:e("template.variableLabels.display_name"),value:"display_name",description:e("template.variableDescriptions.display_name")},{label:e("template.variableLabels.followers_count"),value:"followers_count",description:e("template.variableDescriptions.followers_count")},{label:e("template.variableLabels.following_count"),value:"following_count",description:e("template.variableDescriptions.following_count")},{label:e("template.variableLabels.post_count"),value:"post_count",description:e("template.variableDescriptions.post_count")},{label:e("template.variableLabels.bio"),value:"bio",description:e("template.variableDescriptions.bio")},{label:e("template.variableLabels.website"),value:"website",description:e("template.variableDescriptions.website")},{label:e("template.variableLabels.category"),value:"category",description:e("template.variableDescriptions.category")}],B=c(),N=c(),O=c(0),Z=t=>{var R;const a=(R=B.value)==null?void 0:R.$el.querySelector("textarea");if(!a)return;N.value=a;const v=a.selectionStart||0,k=a.selectionEnd||0,_=i.value.content,b=_.substring(0,v)+`{${t}}`+_.substring(k);i.value.content=b,i.value.variables||(i.value.variables=[]),i.value.variables.includes(t)||i.value.variables.push(t),H(()=>{if(a){a.focus();const D=v+t.length+2;a.setSelectionRange(D,D),O.value=D}})},G=c(""),P=c(!1),ee=async()=>{await f(async()=>{const t={username:"example_user",display_name:"Example User",followers_count:1234,following_count:567,post_count:89,bio:"这是一个示例简介",website:"https://example.com",category:"个人博主"},a=await x.previewTemplate(i.value.id,t);G.value=a,P.value=!0})},h=async()=>{await f(async()=>{const t=await x.getTemplates({page:T.value,pageSize:z.value});t&&(V.value=t.items,F.value=t.total)})},te=t=>{T.value=t,h()},ae=t=>{z.value=t,T.value=1,h()},le=()=>{I.value=e("template.createTemplate"),i.value={id:0,name:"",content:"",variables:[],platform:L.INSTAGRAM,is_default:!1,updated_at:new Date().toISOString()},w.value=!0},ne=t=>{I.value=e("template.editTemplate"),i.value={id:t.id,name:t.name,content:t.content,variables:t.variables,platform:t.platform,is_default:t.is_default,updated_at:t.updated_at},w.value=!0},oe=async t=>{try{await xe.confirm("确定要删除这个模板吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await f(async()=>{await x.deleteTemplate(t.id),await h()})}catch(a){a!=="cancel"&&console.error("删除模板失败:",a)}},se=async t=>{await f(async()=>{await x.setDefaultTemplate(t.id),await h()})},ie=async()=>{U.value&&await f(async()=>{var a;await U.value.validate();const t={name:i.value.name,content:i.value.content,variables:((a=i.value.content.match(/\{([^}]+)\}/g))==null?void 0:a.map(v=>v.slice(1,-1)))||[],platform:i.value.platform,is_default:i.value.is_default};i.value.id?await x.updateTemplate(i.value.id,t):await x.createTemplate(t),w.value=!1,await h()})},y=t=>{const a=t.target;O.value=a.selectionStart||0};return fe(()=>{h(),H(()=>{var a;const t=(a=B.value)==null?void 0:a.$el.querySelector("textarea");t&&(N.value=t,t.addEventListener("click",y),t.addEventListener("keyup",y),t.addEventListener("focus",y))})}),be(()=>{const t=N.value;t&&(t.removeEventListener("click",y),t.removeEventListener("keyup",y),t.removeEventListener("focus",y))}),(t,a)=>{const v=p("el-icon"),k=p("el-button"),_=p("el-tag"),b=p("el-table-column"),R=p("el-table"),D=p("el-pagination"),re=p("el-card"),W=p("el-input"),S=p("el-form-item"),q=p("el-option"),ue=p("el-select"),ce=p("el-switch"),de=p("el-form"),j=p("el-dialog"),pe=he("loading");return g(),A("div",De,[r("div",Se,[r("div",Le,[l(k,{type:"primary",onClick:le},{default:o(()=>[l(v,null,{default:o(()=>[l(s(ge))]),_:1}),m(" "+u(s(e)("template.createTemplate")),1)]),_:1})])]),l(re,{class:"template-table-card"},{default:o(()=>[we((g(),$(R,{data:V.value,style:{width:"100%"},"cell-style":{padding:"16px 0"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:600,padding:"12px 0"}},{default:o(()=>[l(b,{prop:"name",label:s(e)("template.templateName"),"min-width":"180"},{default:o(({row:n})=>[r("div",Ee,[r("span",ze,u(n.name),1),n.is_default?(g(),$(_,{key:0,type:"success",effect:"light",size:"small"},{default:o(()=>[m(u(s(e)("common.yes")),1)]),_:1})):K("",!0)])]),_:1},8,["label"]),l(b,{prop:"content",label:s(e)("template.templateContent"),"min-width":"300","show-overflow-tooltip":""},{default:o(({row:n})=>[r("div",Re,u(n.content),1)]),_:1},8,["label"]),l(b,{label:s(e)("template.variables"),"min-width":"220"},{default:o(({row:n})=>[r("div",$e,[(g(!0),A(J,null,Q(n.variables,C=>(g(),$(_,{key:C,size:"small",effect:"plain",class:"variable-tag"},{default:o(()=>[m(u(C),1)]),_:2},1024))),128))])]),_:1},8,["label"]),l(b,{label:s(e)("common.updateTime"),width:"180"},{default:o(({row:n})=>[m(u(new Date(n.updated_at).toLocaleString()),1)]),_:1},8,["label"]),l(b,{label:s(e)("common.actions"),width:"200",fixed:"right"},{default:o(n=>[r("div",Ie,[l(_,{type:"primary",size:"small",onClick:C=>ne(n.row)},{default:o(()=>[l(v,null,{default:o(()=>[l(s(ye))]),_:1}),m(" "+u(s(e)("common.edit")),1)]),_:2},1032,["onClick"]),n.row.is_default?K("",!0):(g(),$(_,{key:0,type:"success",size:"small",onClick:C=>se(n.row)},{default:o(()=>[l(v,null,{default:o(()=>[l(s(ke))]),_:1}),m(" "+u(s(e)("template.setDefault")),1)]),_:2},1032,["onClick"])),l(_,{type:"danger",size:"small",onClick:C=>oe(n.row)},{default:o(()=>[l(v,null,{default:o(()=>[l(s(Ce))]),_:1}),m(" "+u(s(e)("common.delete")),1)]),_:2},1032,["onClick"])])]),_:1},8,["label"])]),_:1},8,["data"])),[[pe,s(M)]]),r("div",Ue,[l(D,{"current-page":T.value,"onUpdate:currentPage":a[0]||(a[0]=n=>T.value=n),"page-size":z.value,"onUpdate:pageSize":a[1]||(a[1]=n=>z.value=n),"page-sizes":[10,20,50,100],total:F.value,layout:"total, sizes, prev, pager, next",onSizeChange:ae,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1}),l(j,{modelValue:w.value,"onUpdate:modelValue":a[7]||(a[7]=n=>w.value=n),title:I.value,width:"600px","destroy-on-close":""},{footer:o(()=>[l(k,{onClick:a[6]||(a[6]=n=>w.value=!1)},{default:o(()=>[m(u(s(e)("common.cancel")),1)]),_:1}),l(k,{type:"primary",onClick:ie},{default:o(()=>[m(u(s(e)("common.confirm")),1)]),_:1})]),default:o(()=>[l(de,{ref_key:"formRef",ref:U,model:i.value,rules:X,"label-width":"100px"},{default:o(()=>[l(S,{label:s(e)("template.templateName"),prop:"name"},{default:o(()=>[l(W,{modelValue:i.value.name,"onUpdate:modelValue":a[2]||(a[2]=n=>i.value.name=n),placeholder:s(e)("template.namePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(S,{label:s(e)("template.templateContent"),prop:"content"},{default:o(()=>[r("div",Be,[l(W,{ref_key:"contentInputRef",ref:B,modelValue:i.value.content,"onUpdate:modelValue":a[3]||(a[3]=n=>i.value.content=n),type:"textarea",rows:6,placeholder:s(e)("template.contentPlaceholder")},null,8,["modelValue","placeholder"]),r("div",Ne,[r("div",Pe,[(g(),A(J,null,Q(Y,n=>l(_,{key:n.value,class:"clickable-tag",size:"small",effect:"plain",onClick:C=>Z(n.value)},{default:o(()=>[m(u(n.label),1)]),_:2},1032,["onClick"])),64))])])])]),_:1},8,["label"]),l(S,{label:s(e)("common.platform"),prop:"platform"},{default:o(()=>[l(ue,{modelValue:i.value.platform,"onUpdate:modelValue":a[4]||(a[4]=n=>i.value.platform=n),placeholder:s(e)("template.platformSelect")},{default:o(()=>[l(q,{label:"Instagram",value:s(L).INSTAGRAM},null,8,["value"]),l(q,{label:"Twitter",value:s(L).TWITTER},null,8,["value"]),l(q,{label:"Facebook",value:s(L).FACEBOOK},null,8,["value"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(S,{label:s(e)("template.isDefault")},{default:o(()=>[l(ce,{modelValue:i.value.is_default,"onUpdate:modelValue":a[5]||(a[5]=n=>i.value.is_default=n)},null,8,["modelValue"])]),_:1},8,["label"]),l(S,null,{default:o(()=>[r("div",qe,[l(k,{type:"primary",link:"",onClick:ee},{default:o(()=>[m(u(s(e)("template.previewEffect")),1)]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:P.value,"onUpdate:modelValue":a[8]||(a[8]=n=>P.value=n),title:s(e)("template.previewTitle"),width:"500px"},{default:o(()=>[r("div",Ae,[r("div",Me,u(s(e)("template.previewData")),1),r("div",Fe,u(G.value),1)])]),_:1},8,["modelValue","title"])])}}}),Ke=Ve(Oe,[["__scopeId","data-v-63fd09e6"]]);export{Ke as default};
